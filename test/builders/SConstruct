from SCons.Builder import Builder

env = Environment()

def e(target, source, env):
    print target
    print source
    print env
    return (target, source)

builder = Builder(
    action = { ".blah" : "echo blah_builder targets: $TARGETS sources: $SOURCES" },
    target_factory = env.File,
    prefix = "blah_",
    suffix = "blah",
    src_suffix = "blah",
    emitter = e,
    ensure_suffix = True)

env.Append(BUILDERS = { "Blah" : builder })

env.Command("qux.blah", "SConstruct", "echo targets: $TARGETS  sources: $SOURCES")
env.AddPreAction("qux.blah", "echo PreAction $TARGET")
env.AddPostAction("qux.blah", "echo PostAction $TARGET")
blah = env.Blah("foo.bar", "qux")
env.Command("SConstruct.blah", "SConstruct", "echo targets: $TARGETS sources: $SOURCES")
print env.Blah("SConstruct")
baz = env.Command(Alias("baz"), [blah, "blah_SConstruct.blah"], "echo targets: $TARGETS sources: $SOURCES")
AlwaysBuild(baz)
env.Default(Alias("baz"))
